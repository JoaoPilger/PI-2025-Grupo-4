generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Cliente {
  id              Int            @id @default(autoincrement())
  nome            String
  email           String         @unique
  senha           String
  distribuidoraId Int

  distribuidora   Distribuidora  @relation(fields: [distribuidoraId], references: [id])
  comodos         Comodo[]
  simulacoes      Simulacao[]
}

model Distribuidora {
  id       Int       @id @default(autoincrement())
  nome     String
  tarifa   Decimal   @db.Decimal(10,2) // tarifa em R$/kWh

  clientes Cliente[]
}

model Comodo {
  id         Int    @id @default(autoincrement())
  nomeComodo String
  clienteId  Int

  cliente     Cliente           @relation(fields: [clienteId], references: [id])
  eletros     EletroComodo[]
  simulacoes  SimulacaoComodo[]
}

model Eletrodomestico {
  id          Int            @id @default(autoincrement())
  nomeEletro  String
  comodos     EletroComodo[] // relação inversa
}

model EletroComodo {
  id             Int @id @default(autoincrement())
  comodoId       Int
  eletroId       Int
  quantidade     Int
  horasUsoDia    Decimal   @db.Decimal(5,2)
  potencia       Int

  comodo          Comodo          @relation(fields: [comodoId], references: [id])
  eletrodomestico Eletrodomestico @relation(fields: [eletroId], references: [id])
}

model Simulacao {
  id                 Int                @id @default(autoincrement())
  nomeSimulacao      String
  data               DateTime           @default(now())
  consumo            Decimal?           @db.Decimal(10,2) // total de kWh
  custo              Decimal?           @db.Decimal(10,2) // consumo * tarifa
  clienteId          Int

  cliente            Cliente            @relation(fields: [clienteId], references: [id])
  simulacoesComodos  SimulacaoComodo[]  // relação com os cômodos
}

model SimulacaoComodo {
  id           Int        @id @default(autoincrement())
  simulacaoId  Int
  comodoId     Int

  simulacao    Simulacao  @relation(fields: [simulacaoId], references: [id])
  comodo       Comodo     @relation(fields: [comodoId], references: [id])
}

model Session {
  sid    String   @id @db.VarChar(255)
  sess   Json
  expire DateTime

  @@map("session")
}
